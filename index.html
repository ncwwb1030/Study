<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INFS5720 å‚™è€ƒç¥å™¨</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

    <style>
        /* è‡ªå®šç¾©å­—å‹èˆ‡æ»¾å‹•æ¢éš±è— */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
            -webkit-tap-highlight-color: transparent;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* æ¼¸å±¤èƒŒæ™¯å‹•ç•« */
        .app-gradient {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #10b981 100%);
            background-size: 200% 200%;
            animation: gradientMove 15s ease infinite;
        }

        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .tab-active {
            background-color: rgba(255, 255, 255, 0.2);
            border-bottom: 3px solid #10b981;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen flex flex-col relative">

    <header class="app-gradient text-white pb-24 pt-8 px-6 rounded-b-[2.5rem] shadow-lg z-10 relative">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-2xl font-bold tracking-wide">INFS5720 å‚™è€ƒåŠ©æ‰‹</h1>
                <p class="text-sm text-blue-100 opacity-90">Final Exam è¡åˆºæ¨¡å¼</p>
            </div>
            <div class="bg-white/20 p-2 rounded-full backdrop-blur-sm">
                <i class="fas fa-graduation-cap text-xl"></i>
            </div>
        </div>

        <nav class="flex overflow-x-auto hide-scrollbar space-x-6 pb-2">
            <button v-for="tab in tabs" :key="tab.id" 
                @click="currentTab = tab.id"
                class="flex flex-col items-center min-w-[4rem] space-y-1 transition-all duration-300 opacity-80 hover:opacity-100"
                :class="{'opacity-100 transform scale-110': currentTab === tab.id}">
                <div class="w-12 h-12 rounded-2xl flex items-center justify-center text-xl shadow-md transition-all"
                     :class="currentTab === tab.id ? 'bg-white text-indigo-600' : 'bg-white/10 text-white'">
                    <i :class="tab.icon"></i>
                </div>
                <span class="text-xs font-medium">{{ tab.name }}</span>
            </button>
        </nav>
    </header>

    <main class="flex-1 -mt-16 px-4 pb-8 z-20">
        
        <div v-if="currentTab === 'outline'" class="space-y-4 animate-fade-in">
            <div class="bg-white rounded-3xl shadow-sm p-6">
                <h2 class="text-lg font-bold text-gray-800 mb-4 border-l-4 border-indigo-500 pl-3">è€ƒè©¦ç¯„åœç¸½è¦½</h2>
                <div class="space-y-3">
                    <div v-for="(section, index) in outlineData" :key="index" class="border-b border-gray-100 last:border-0 pb-3 last:pb-0">
                        <div class="flex items-start">
                            <span class="bg-indigo-100 text-indigo-600 text-xs font-bold px-2 py-1 rounded mr-3 mt-1">{{ section.part }}</span>
                            <div>
                                <h3 class="font-semibold text-gray-700">{{ section.title }}</h3>
                                <p class="text-sm text-gray-500 mt-1 leading-relaxed">{{ section.desc }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-3xl shadow-sm p-6">
                <h2 class="text-lg font-bold text-gray-800 mb-4 border-l-4 border-green-500 pl-3">é«˜é »è€ƒé»é€Ÿè¨˜</h2>
                <ul class="list-disc list-inside space-y-2 text-sm text-gray-600">
                    <li><strong class="text-gray-800">Supervised:</strong> æœ‰ Target (Regression, Classification)</li>
                    <li><strong class="text-gray-800">Unsupervised:</strong> ç„¡ Target (Clustering, PCA)</li>
                    <li><strong class="text-gray-800">RL:</strong> Reward System (MAB)</li>
                    <li><strong class="text-gray-800">Deep Learning:</strong> Multi-layer NN, è‡ªå‹•ç‰¹å¾µæå–</li>
                </ul>
            </div>
        </div>

        <div v-if="currentTab === 'mindmap'" class="bg-white rounded-3xl shadow-sm p-4 min-h-[500px] flex flex-col">
            <h2 class="text-lg font-bold text-gray-800 mb-2 border-l-4 border-purple-500 pl-3">æ©Ÿå™¨å­¸ç¿’æ¨¡å‹åˆ†é¡</h2>
            <p class="text-xs text-gray-400 mb-4">é›™æŒ‡ç¸®æ”¾æŸ¥çœ‹ç´°ç¯€</p>
            <div class="flex-1 overflow-auto flex justify-center items-center bg-gray-50 rounded-2xl border border-gray-100">
                <div class="mermaid transform scale-90 origin-top">
                    graph TD
                    ML[Machine Learning] --> Sup[Supervised<br/>Has Target]
                    ML --> Unsup[Unsupervised<br/>No Target]
                    ML --> RL[Reinforcement<br/>Reward based]
                    
                    Sup --> Reg[Regression<br/>Target: Continuous]
                    Sup --> Class[Classification<br/>Target: Categorical]
                    
                    Reg --> LinR[Linear / Multiple Reg]
                    Reg --> Lasso[Lasso / Ridge<br/>Regularized]
                    
                    Class --> LogR[Logistic Regression]
                    Class --> DT[Decision Tree]
                    Class --> ANN[ANN / CNN]
                    Class --> Ens[Ensemble<br/>RF / Boosting]
                    
                    Unsup --> Clust[Clustering]
                    Unsup --> DimRed[Dim Reduction]
                    
                    Clust --> Kmeans[K-Means]
                    Clust --> Hier[Hierarchical]
                    
                    DimRed --> PCA[PCA]
                    
                    RL --> MAB[Multi-Armed Bandits]
                    
                    style ML fill:#4f46e5,stroke:#fff,color:#fff
                    style Sup fill:#c4b5fd,stroke:#fff
                    style Unsup fill:#c4b5fd,stroke:#fff
                    style RL fill:#c4b5fd,stroke:#fff
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'notes'" class="space-y-4">
            <div v-for="(note, index) in notesData" :key="index" class="bg-white rounded-2xl shadow-sm overflow-hidden transition-all duration-200">
                <div @click="toggleNote(index)" class="p-5 flex justify-between items-center cursor-pointer active:bg-gray-50">
                    <div class="flex items-center space-x-3">
                        <span class="w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center font-bold text-sm">{{ note.id }}</span>
                        <h3 class="font-bold text-gray-800">{{ note.title }}</h3>
                    </div>
                    <i class="fas fa-chevron-down text-gray-300 transition-transform duration-300" :class="{'rotate-180': note.isOpen}"></i>
                </div>
                <div v-show="note.isOpen" class="px-5 pb-5 pt-0 text-sm text-gray-600 border-t border-gray-100 mt-2">
                    <ul class="space-y-2 mt-3 pl-2 border-l-2 border-gray-200">
                        <li v-for="(point, pIndex) in note.points" :key="pIndex" class="leading-relaxed">
                            â€¢ <span v-html="point"></span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'bank'" class="space-y-4">
            <div class="bg-white rounded-3xl shadow-sm p-6 mb-4 sticky top-0 z-30 border-b border-gray-100">
                <h2 class="text-lg font-bold text-gray-800">å¿…è€ƒé¡Œåº«ç¸½è¦½</h2>
                <p class="text-xs text-gray-500">å…± {{ questionBank.length }} é¡Œé‡é»æ¨¡æ“¬</p>
            </div>
            
            <div v-for="(q, index) in questionBank" :key="index" class="bg-white rounded-2xl shadow-sm p-5 relative overflow-hidden">
                <div class="absolute top-0 right-0 bg-green-100 text-green-700 text-xs px-2 py-1 rounded-bl-xl font-bold">{{ q.category }}</div>
                <p class="font-semibold text-gray-800 mb-3 pr-4">{{ index + 1 }}. {{ q.question }}</p>
                <div class="space-y-2">
                    <div class="text-sm bg-gray-50 p-2 rounded border border-gray-100 text-gray-500">
                        <span class="font-bold text-green-600">ç­”æ¡ˆï¼š</span> {{ q.answer }}
                    </div>
                    <div class="text-xs text-gray-400 p-1">
                        <i class="fas fa-lightbulb text-yellow-400 mr-1"></i> è§£æ: {{ q.explanation }}
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'quiz'" class="bg-white rounded-3xl shadow-sm p-6 min-h-[400px] flex flex-col justify-center">
            
            <div v-if="quizState === 'start'" class="text-center space-y-6">
                <div class="w-24 h-24 bg-indigo-50 rounded-full flex items-center justify-center mx-auto text-indigo-500 text-4xl mb-4">
                    <i class="fas fa-brain"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">æ™ºèƒ½åˆ·é¡Œæ¨¡å¼</h2>
                <p class="text-gray-500 px-4">ç³»çµ±å°‡å¾é¡Œåº«éš¨æ©ŸæŠ½å– 5 é¡Œï¼Œæ¨¡æ“¬è€ƒè©¦ç’°å¢ƒã€‚</p>
                <button @click="startQuiz" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-bold py-4 rounded-xl shadow-lg transform active:scale-95 transition-transform">
                    é–‹å§‹æ¸¬é©—
                </button>
            </div>

            <div v-if="quizState === 'playing'" class="flex-1 flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <span class="text-xs font-bold text-gray-400">Question {{ currentQuestionIndex + 1 }} / {{ quizQuestions.length }}</span>
                    <span class="text-xs font-bold text-indigo-500 bg-indigo-50 px-2 py-1 rounded">Score: {{ score }}</span>
                </div>
                
                <h3 class="text-lg font-bold text-gray-800 mb-6 leading-relaxed">{{ quizQuestions[currentQuestionIndex].question }}</h3>
                
                <div class="space-y-3 flex-1">
                    <button v-for="(opt, idx) in quizQuestions[currentQuestionIndex].options" :key="idx"
                        @click="checkAnswer(opt)"
                        :class="getOptionClass(opt)"
                        :disabled="hasAnswered"
                        class="w-full text-left p-4 rounded-xl border-2 text-sm font-medium transition-all duration-200">
                        {{ opt }}
                    </button>
                </div>

                <div v-if="hasAnswered" class="mt-6 animate-fade-in-up">
                    <div v-if="isCorrect" class="text-green-600 font-bold mb-2 flex items-center"><i class="fas fa-check-circle mr-2"></i> æ­£ç¢ºï¼</div>
                    <div v-else class="text-red-500 font-bold mb-2 flex items-center"><i class="fas fa-times-circle mr-2"></i> éŒ¯èª¤ï¼Œç­”æ¡ˆæ˜¯ {{ quizQuestions[currentQuestionIndex].answer }}</div>
                    
                    <button @click="nextQuestion" class="w-full bg-gray-800 text-white py-3 rounded-xl font-bold shadow-md">
                        {{ currentQuestionIndex < quizQuestions.length - 1 ? 'ä¸‹ä¸€é¡Œ' : 'æŸ¥çœ‹çµæœ' }}
                    </button>
                </div>
            </div>

            <div v-if="quizState === 'result'" class="text-center">
                <div class="text-6xl mb-4">{{ score === 5 ? 'ğŸ†' : (score >=3 ? 'ğŸ˜Š' : 'ğŸ’ª') }}</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">æ¸¬é©—å®Œæˆ</h2>
                <p class="text-gray-500 mb-8">ä½ çš„å¾—åˆ†ï¼š<span class="text-indigo-600 text-3xl font-bold mx-2">{{ score }}</span> / {{ quizQuestions.length }}</p>
                <button @click="startQuiz" class="w-full bg-indigo-50 text-indigo-600 font-bold py-3 rounded-xl border border-indigo-200 mb-3">
                    å†æ¸¬ä¸€æ¬¡
                </button>
                <button @click="currentTab = 'bank'" class="w-full text-gray-400 font-medium text-sm py-2">
                    è¤‡ç¿’é¡Œåº«
                </button>
            </div>

        </div>

    </main>

</div>

<script>
    const { createApp, ref, onMounted, nextTick, watch } = Vue;

    createApp({
        setup() {
            const currentTab = ref('outline');
            
            const tabs = [
                { id: 'outline', name: 'é‡é»', icon: 'fas fa-list-ul' },
                { id: 'mindmap', name: 'åœ–è­œ', icon: 'fas fa-project-diagram' },
                { id: 'notes', name: 'ç­†è¨˜', icon: 'fas fa-book-open' },
                { id: 'bank', name: 'é¡Œåº«', icon: 'fas fa-database' },
                { id: 'quiz', name: 'åˆ·é¡Œ', icon: 'fas fa-gamepad' },
            ];

            const outlineData = [
                { part: "Part 0", title: "æ¨¡å‹åˆ†é¡", desc: "Supervised (Regression/Classification), Unsupervised (Clustering/PCA), RL (MAB)" },
                { part: "Part 1", title: "è©•ä¼°æŒ‡æ¨™", desc: "MSE, RMSE, RÂ² (Regression); Accuracy, Precision, Recall, F1, ROC/AUC (Classification)" },
                { part: "Part 2", title: "æ ¸å¿ƒæ¦‚å¿µ", desc: "Bias-Variance Tradeoff, Overfitting vs Underfitting, Regularization (L1/L2)" },
                { part: "Part 3", title: "æ¨¡å‹ç´°ç¯€", desc: "Logistic Regression (Logit/Odds), Decision Tree (Gini/Entropy), ANN (Backprop), CNN (Filter/Pooling)" }
            ];

            const notesData = ref([
                { 
                    id: "L1", title: "Intro & ML Categories", isOpen: false, 
                    points: [
                        "<b>Descriptive/Diagnostic/Predictive/Prescriptive</b>: æŒ‰ç›®çš„åˆ†é¡ã€‚",
                        "<b>Supervised</b>: æœ‰ Label (y)ã€‚ç”¨æ–¼é æ¸¬ã€‚",
                        "<b>Unsupervised</b>: ç„¡ Labelã€‚ç”¨æ–¼æ‰¾è¦å¾‹ (Clustering) æˆ–é™ç¶­ (PCA)ã€‚",
                        "<b>DL vs ML</b>: DL ä½¿ç”¨å¤šå±¤ NNï¼Œè‡ªå‹•æå–ç‰¹å¾µã€‚"
                    ] 
                },
                { 
                    id: "L2", title: "Clustering & PCA", isOpen: false, 
                    points: [
                        "<b>K-Means</b>: éš¨æ©Ÿé¸ä¸­å¿ƒ -> åˆ†é…é» -> æ›´æ–°ä¸­å¿ƒã€‚å° Outlier æ•æ„Ÿï¼Œåªé©åˆåœ“å½¢ Clusterã€‚",
                        "<b>Hierarchical</b>: Dendrogram æ±ºå®š Cluster æ•¸ã€‚ä¸éœ€è¦é å…ˆæŒ‡å®š Kã€‚",
                        "<b>Silhouette Score</b>: æ¥è¿‘ 1 æœ€å¥½ï¼Œ0 ä»£è¡¨é‡ç–Šï¼Œè² æ•¸ä»£è¡¨åˆ†éŒ¯ã€‚",
                        "<b>PCA</b>: é™ç¶­ã€‚PC1 è§£é‡‹æœ€å¤§è®Šç•°ã€‚æ˜¯ç·šæ€§è½‰æ›ã€‚ç„¡ Supervisedã€‚"
                    ] 
                },
                { 
                    id: "L3", title: "Regression (Lin & Log)", isOpen: false, 
                    points: [
                        "<b>Linear</b>: MSE, RMSE, RÂ²ã€‚æ³¨æ„ Multicollinearityã€‚",
                        "<b>Logistic</b>: é æ¸¬æ©Ÿç‡ã€‚Logit æ˜¯ç·šæ€§çš„ã€‚Odds Ratio = exp(beta)ã€‚",
                        "<b>Metrics</b>: Imbalanced data ä¸è¦åªçœ‹ Accuracyï¼Œè¦çœ‹ Recall/Precision/F1ã€‚"
                    ] 
                },
                { 
                    id: "L4", title: "Regularization", isOpen: false, 
                    points: [
                        "<b>Bias-Variance</b>: ç°¡å–®æ¨¡å‹ High Bias (Underfit)ï¼Œè¤‡é›œæ¨¡å‹ High Variance (Overfit)ã€‚",
                        "<b>Lasso (L1)</b>: èƒ½æŠŠä¿‚æ•¸è®Š 0 (Feature Selection)ã€‚",
                        "<b>Ridge (L2)</b>: ä¿‚æ•¸è®Šå°ä½†ä¸ç‚º 0ã€‚é©åˆå¤šè®Šæ•¸ã€‚",
                        "<b>Scaling</b>: åš Regularization å‰å¿…é ˆ Standardize è®Šæ•¸ã€‚"
                    ] 
                },
                { 
                    id: "L5", title: "Decision Tree", isOpen: false, 
                    points: [
                        "<b>Split</b>: ç›®æ¨™æ˜¯å¢åŠ ç´”åº¦ã€‚Classification ç”¨ Gini/Entropyï¼›Regression ç”¨ SSEã€‚",
                        "<b>Pruning</b>: é˜²æ­¢ Overfittingã€‚Cost-complexity pruningã€‚",
                        "<b>å„ªé»</b>: å¯è§£é‡‹æ€§é«˜ï¼Œéç·šæ€§ï¼Œä¸éœ€è¦ Scalingã€‚"
                    ] 
                },
                { 
                    id: "L7", title: "ANN", isOpen: false, 
                    points: [
                        "<b>Activation</b>: å¿…é ˆæ˜¯éç·šæ€§ (Sigmoid, ReLU)ï¼Œå¦å‰‡å¤šå±¤ç­‰æ–¼ä¸€å±¤ã€‚",
                        "<b>Backpropagation</b>: åˆ©ç”¨ Chain Rule è¨ˆç®— Gradient æ›´æ–°æ¬Šé‡ã€‚",
                        "<b>Forward Pass</b>: è¨ˆç®—é æ¸¬å€¼ã€‚"
                    ] 
                },
                { 
                    id: "L8", title: "Ensemble", isOpen: false, 
                    points: [
                        "<b>Bagging</b>: ä¸¦è¡Œè¨“ç·´ (Bootstrap)ã€‚æ¸›å°‘ Varianceã€‚Ex: Random Forestã€‚",
                        "<b>Boosting</b>: ä¸²è¡Œè¨“ç·´ (ä¿®æ­£å‰ä¸€å€‹éŒ¯èª¤)ã€‚æ¸›å°‘ Biasã€‚Ex: AdaBoostã€‚",
                        "<b>RF</b>: éš¨æ©Ÿé¸æ¨£æœ¬ + éš¨æ©Ÿé¸ç‰¹å¾µ (Feature Randomness)ã€‚"
                    ] 
                },
                { 
                    id: "L9", title: "MAB (RL)", isOpen: false, 
                    points: [
                        "<b>Exploration vs Exploitation</b>: æ¢ç´¢æ–° Arm vs åˆ©ç”¨å·²çŸ¥æœ€å¥½ Armã€‚",
                        "<b>E-Greedy</b>: E æ©Ÿç‡éš¨æ©Ÿé¸ï¼Œ1-E é¸æœ€å¥½ã€‚",
                        "<b>Thompson Sampling</b>: Bayesian æ¦‚ç‡æ–¹æ³•ï¼Œæ ¹æ“š Beta åˆ†å¸ƒæŠ½æ¨£ã€‚"
                    ] 
                },
                { 
                    id: "L10", title: "CNN", isOpen: false, 
                    points: [
                        "<b>Convolution</b>: æå–å±€éƒ¨ç‰¹å¾µ (Edges, Shapes)ã€‚æ¬Šé‡å…±äº«ã€‚",
                        "<b>Pooling</b>: é™ç¶­ï¼Œä¿ç•™é‡è¦ç‰¹å¾µ (Max Pooling)ã€‚",
                        "<b>Structure</b>: Conv -> ReLU -> Pool -> FCã€‚"
                    ] 
                }
            ]);

            // Generated Question Bank based on Lecture contents
            const questionBank = [
                { category: "L1 Intro", question: "Which analytics type asks 'What will happen?'", answer: "Predictive Analytics", options: ["Descriptive", "Diagnostic", "Predictive", "Prescriptive"], explanation: "Descriptive=Past, Predictive=Future." },
                { category: "L2 Clustering", question: "K-Means objective is to minimize?", answer: "Within-cluster variance", options: ["Between-cluster variance", "Within-cluster variance", "Total variance", "Silhouette score"], explanation: "K-Means tries to make clusters tight (low variance inside)." },
                { category: "L2 PCA", question: "Does PCA consider the target variable y?", answer: "No", options: ["Yes", "No", "Sometimes", "Only for regression"], explanation: "PCA is Unsupervised Learning." },
                { category: "L3 Logistic", question: "If coeff beta=0.5, how does Odds change for unit increase in x?", answer: "Multiplies by exp(0.5)", options: ["Adds 0.5", "Multiplies by 0.5", "Multiplies by exp(0.5)", "No change"], explanation: "Odds Ratio = exp(beta)." },
                { category: "L4 Reg", question: "Which regularization method performs feature selection?", answer: "Lasso (L1)", options: ["Ridge (L2)", "Lasso (L1)", "Linear Regression", "None"], explanation: "L1 penalty can force coefficients to exactly zero." },
                { category: "L5 Tree", question: "What metric does CART use for Classification split?", answer: "Gini Impurity", options: ["SSE", "Gini Impurity", "R-squared", "RMSE"], explanation: "CART uses Gini for classification, SSE for regression." },
                { category: "L7 ANN", question: "Why do we need activation functions?", answer: "To introduce non-linearity", options: ["To speed up calculation", "To introduce non-linearity", "To normalize data", "To reduce overfitting"], explanation: "Without them, multi-layer NN is just a single linear layer." },
                { category: "L8 Ensemble", question: "Random Forest reduces variance by using?", answer: "Bagging + Feature Randomness", options: ["Boosting", "Bagging + Feature Randomness", "Pruning", "Regularization"], explanation: "RF uses Bootstrap aggregation and random feature selection." },
                { category: "L9 MAB", question: "In MAB, trying a new arm to see if it's better is called?", answer: "Exploration", options: ["Exploitation", "Exploration", "Optimization", "Calculation"], explanation: "Exploitation uses best known; Exploration tries unknowns." },
                { category: "L10 CNN", question: "What is the main purpose of Pooling?", answer: "Dimension reduction & Invariance", options: ["Feature extraction", "Dimension reduction & Invariance", "Classification", "Activation"], explanation: "Pooling reduces size and handles small shifts." }
            ];

            const quizState = ref('start'); // start, playing, result
            const quizQuestions = ref([]);
            const currentQuestionIndex = ref(0);
            const score = ref(0);
            const hasAnswered = ref(false);
            const isCorrect = ref(false);

            function toggleNote(index) {
                notesData.value[index].isOpen = !notesData.value[index].isOpen;
            }

            function startQuiz() {
                // Shuffle and pick 5
                const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
                quizQuestions.value = shuffled.slice(0, 5).map(q => {
                    // Create options including the correct answer
                    let opts = q.options; 
                    if(!opts) { // Fallback if options not defined in object above
                         opts = [q.answer, "Wrong A", "Wrong B", "Wrong C"].sort(() => 0.5 - Math.random());
                    }
                    return { ...q, options: opts };
                });
                currentQuestionIndex.value = 0;
                score.value = 0;
                hasAnswered.value = false;
                quizState.value = 'playing';
            }

            function checkAnswer(selectedOpt) {
                hasAnswered.value = true;
                const correct = quizQuestions.value[currentQuestionIndex.value].answer;
                if(selectedOpt === correct) {
                    isCorrect.value = true;
                    score.value++;
                } else {
                    isCorrect.value = false;
                }
            }

            function nextQuestion() {
                if (currentQuestionIndex.value < quizQuestions.value.length - 1) {
                    currentQuestionIndex.value++;
                    hasAnswered.value = false;
                    isCorrect.value = false;
                } else {
                    quizState.value = 'result';
                }
            }

            function getOptionClass(opt) {
                if (!hasAnswered.value) return 'border-gray-100 bg-gray-50 text-gray-600 hover:border-indigo-300';
                
                const correct = quizQuestions.value[currentQuestionIndex.value].answer;
                if (opt === correct) return 'border-green-500 bg-green-50 text-green-700';
                // If user clicked this and it's wrong (hard to track clicked state without extra var, simplified here)
                return 'border-gray-100 bg-gray-50 text-gray-400 opacity-50';
            }

            // Watch for tab change to render Mermaid
            watch(currentTab, (newTab) => {
                if (newTab === 'mindmap') {
                    nextTick(() => {
                        mermaid.init();
                    });
                }
            });

            onMounted(() => {
                mermaid.initialize({ startOnLoad: false, theme: 'neutral' });
            });

            return {
                currentTab, tabs, outlineData, notesData, questionBank,
                toggleNote,
                quizState, quizQuestions, currentQuestionIndex, score, hasAnswered, isCorrect,
                startQuiz, checkAnswer, nextQuestion, getOptionClass
            };
        }
    }).mount('#app');
</script>

</body>
</html>
